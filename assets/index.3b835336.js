var e,t,a,n,s,r,l,o,u,c,i,p,m,d,b,f,g,h=Object.defineProperty,v=Object.defineProperties,x=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,C=(e,t,a)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,T=(e,t)=>{for(var a in t||(t={}))y.call(t,a)&&C(e,a,t[a]);if(N)for(var a of N(t))S.call(t,a)&&C(e,a,t[a]);return e},E=(e,t)=>v(e,x(t));import{v as w,d as I,l as k,F as O,y as L,D as A,S as H}from"./vendor.cec4665d.js";(t=e||(e={})).And="And",t.Or="Or",t.Not="Not",(n=a||(a={})).IsBefore="IsBefore",n.IsAfter="IsAfter",n.IsBetween="IsBetween",(r=s||(s={})).MoreThan="MoreThan",r.LessThan="LessThan",r.MoreThanOrEqual="MoreThanOrEqual",r.LessThanOrEqual="LessThanOrEqual",r.Equal="Equal",(o=l||(l={})).Is="Is",o.IsNot="IsNot",(c=u||(u={})).IsChecked="IsChecked",c.IsNotChecked="IsNotChecked",(p=i||(i={})).AllOf="AllOf",p.NoneOf="NoneOf",p.AnyOf="AnyOf",p.NumberOf="NumberOf",p.Size="Size",(d=m||(m={})).Exists="Exists",d.ExistsAnd="ExistsAnd",(b||(b={})).Lookup="Lookup",(g=f||(f={}))[g.Date=0]="Date",g[g.Number=1]="Number",g[g.Enum=2]="Enum",g[g.Boolean=3]="Boolean",g[g.Collection=4]="Collection",g[g.Optional=5]="Optional",g[g.Model=6]="Model";const M=[0,1,2,3,4,5];function B(e,t){return e.getSchemata.find((e=>e.name===t))}function P(e){return{label:e.name,attributes:e.attributes.map((e=>q(e))),type:f.Model}}const q=e=>{switch(e.type){case f.Boolean:return E(T({},e),{value:!0});case f.Number:return E(T({},e),{value:0});case f.Collection:return E(T({},e),{value:[]});case f.Enum:{const t=e,{enumSet:a}=t,n=((e,t)=>{var a={};for(var n in e)y.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&N)for(var n of N(e))t.indexOf(n)<0&&S.call(e,n)&&(a[n]=e[n]);return a})(t,["enumSet"]);return E(T({},n),{value:e.enumSet[0]})}default:return E(T({},e),{value:void 0})}};f.Collection,f.Boolean,f.Number,f.Boolean;const R={args:[{args:["Is fully vaccinated"],op:b.Lookup}],op:u.IsChecked};b.Lookup,i.AllOf,b.Lookup,i.Size;s.LessThanOrEqual,e.And;const U={name:"MICE event pilots",attributes:[{label:"Participants are all fully vaccinated",type:f.Boolean},{label:"Type of event",type:f.Enum,enumSet:["Participants are predominantly seated or standing in a fixed position during the session.","Participants are predominantly non-seated and moving about during the session."]},{label:"Number of participants",type:f.Number}]},D={title:"MICE event pilots",rules:[{expr:{args:[{args:[{args:[{args:["Participants are all fully vaccinated"],op:b.Lookup}],op:u.IsNotChecked},{args:[{args:["Number of participants"],op:b.Lookup},50],op:s.LessThanOrEqual}],op:e.And},{args:[{args:[{args:["Participants are all fully vaccinated"],op:b.Lookup}],op:u.IsChecked},{args:[{args:["Type of event"],op:b.Lookup},"Participants are predominantly seated or standing in a fixed position during the session."],op:l.Is},{args:[{args:["Number of participants"],op:b.Lookup},500],op:s.LessThanOrEqual}],op:e.And},{args:[{args:[{args:["Participants are all fully vaccinated"],op:b.Lookup}],op:u.IsChecked},{args:[{args:["Type of event"],op:b.Lookup},"Participants are predominantly non-seated and moving about during the session."],op:l.Is},{args:[{args:["Number of participants"],op:b.Lookup},250],op:s.LessThanOrEqual}],op:e.And}],op:e.Or},input:U}]};function j({model:e,schema:t,onChange:a,store:n}){const s=t=>{const n=[...e.attributes],s=e.attributes.findIndex((e=>e.label===t.currentTarget.name));n[s]=E(T({},n[s]),{value:t.currentTarget.value}),a(E(T({},e),{attributes:n}))},r=t=>{const n="true"===t.currentTarget.value,s=[...e.attributes],r=e.attributes.findIndex((e=>e.label===t.currentTarget.name));s[r]=E(T({},s[r]),{value:n}),a(E(T({},e),{attributes:s}))},l=t=>{const n=[...e.attributes],s=e.attributes.findIndex((e=>e.label===t.currentTarget.name));n[s]=E(T({},n[s]),{value:parseInt(t.currentTarget.value)}),a(E(T({},e),{attributes:n}))},o=t=>{const n=[...e.attributes],s=e.attributes.findIndex((e=>e.label===t.currentTarget.name));n[s]=E(T({},n[s]),{value:Date.parse(t.currentTarget.value)}),a(E(T({},e),{attributes:n}))},u=(e,t,n)=>{const s=t.attributes.slice(),r=t.attributes.findIndex((e=>e.label===n));s[r]=E(T({},s[r]),{value:e}),a(E(T({},t),{attributes:s}))},c=[];for(let i of e.attributes){if(i.type===f.Collection){const a=B(n,t.attributes.find((e=>e.label===i.label)).subtype),s=i.label;let r={value:i.value};c.push(w(F,E(T({},r),{onChange:t=>u(t,e,i.label),subSchema:a,collectionLabel:s})))}if(i.type===f.Boolean&&c.push(w("div",{className:"flex mt-2"},w("h2",{className:"text-lg inline w-1/4"},i.label),w("select",{className:"border-2 pl-2 text-sm font-semibold py-2",onChange:r,name:i.label,value:i.value.toString()},w("option",{value:"true"},"Yes"),w("option",{value:"false"},"No")))),i.type===f.Number&&"number"==typeof i.value&&c.push(w("div",{className:"flex mt-2"},w("h2",{className:"text-lg inline w-1/4"},i.label),w("input",{type:"number",className:"border-2 pl-2 text-sm font-semibold py-2",onChange:l,name:i.label,value:i.value}))),i.type===f.Enum&&"string"==typeof i.value){const e=t.attributes.find((e=>e.label===i.label)).enumSet.map((e=>w("option",{value:e},e)));c.push(w("div",{className:"flex mt-2"},w("h2",{className:"text-lg inline w-1/4"},i.label),w("select",{className:"border-2 pl-2 text-sm font-semibold py-2",value:i.value,onChange:s,name:i.label},e)))}i.type!==f.Date||"string"!=typeof i.value&&void 0!==i.value||c.push(w("div",{className:"flex mt-2"},w("h2",{className:"text-lg inline w-1/4"},i.label),w("input",{type:"date",className:"border-2 pl-2 text-sm font-semibold py-2",onChange:o,name:i.label,value:i.value})))}return w(I,null,w("div",{class:"w-11/12 min-w-max card border-2 p-4 ml-1"},w("h1",{class:"text-2xl border-gray-300 text-gray-900 text-left"},e.label),c))}const F=e=>{const t=e.subSchema,a=[],n=e.store,s=(e,t,a)=>{const n=t.value.slice();n[a]=e,t.onChange(n)},r=t=>{const a=e.value.slice();a.splice(t,1),e.onChange(a)};for(const[l,o]of e.value.entries())a.push(w("div",{className:"flex",key:l},w("div",{className:"text-lg w-24 flex flex-col justify-center items-center"},l+1,w("div",{className:"btn-neutral text-sm font-semibold py-2 px-2 mt-10",onClick:()=>r(l)},w("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},w("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:5,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})))),w("div",{className:"flex-1"},w(j,{model:o,onChange:t=>s(t,e,l),schema:t,store:n}))));return w("div",{className:"border-2 p-4 my-4 card"},w("div",{className:"mt-2"},w("h2",{className:"text-lg mb-2"},e.collectionLabel," (a group consisting of multiple ",e.subSchema.name,")"),a),w("div",{className:"addSubModel mt-6 w-max btn-primary",onClick:()=>{console.log("new submodel");const a=e.value.slice();a.push(P(t)),e.onChange(a)}},"Add new ",e.subSchema.name))},z={Lookup:(e,t)=>{if(void 0===t.attributes)throw new Error(`Input: ${JSON.stringify(t)} is not a model instance`);const a=t.attributes.filter((t=>t.label===e));if(0===a.length)throw new Error(`Label: ${e} of Model: ${t.label} does not exist`);if(a.length>1)throw new Error(`Label: ${e} of Model: ${t.label} does not exist`);return a[0].value},Equal:(e,t)=>e===t,Exists:(e,t)=>!!z[b.Lookup](e,t),ExistsAnd:(e,t)=>z[m.Exists](e,t),Is:(e,t)=>e===t,IsAfter:(e,t)=>e>t,IsBefore:(e,t)=>e<t,IsBetween:(e,t,a)=>t<e&&e<a,IsChecked:e=>!!e,IsNot:(e,t)=>e!==t,IsNotChecked:e=>!e,LessThan:(e,t)=>e<t,LessThanOrEqual:(e,t)=>e<=t,MoreThan:(e,t)=>e>t,MoreThanOrEqual:(e,t)=>e>=t,Not:e=>!e},J=e=>t=>{const a=V(e,t);if("boolean"==typeof a)return a;throw new Error("Not a valid Lambda expression")},V=(t,a)=>{if((e=>!("object"==typeof e))(t))return t;const{op:n,args:s}=t;switch(n){case m.ExistsAnd:return(()=>{const[e,t]=[...s];return!!z[m.Exists](e,a)&&V(t,a)})();case e.And:return s.map((e=>V(e,a))).every((e=>e));case e.Or:return!!s.map((e=>V(e,a))).find((e=>e));case i.AllOf:return(()=>{const[e,t]=[...s];return V(e,a).every(J(t))})();case i.AnyOf:return(()=>{const[e,t]=[...s];return!!V(e,a).find(J(t))})();case i.NoneOf:return(()=>{const[e,t]=[...s],n=V(e,a),r=J(t);return n.every((e=>!r(e)))})();case i.NumberOf:return(()=>{const[e,t]=[...s],n=V(e,a),r=J(t);return n.filter(r).length})();case i.Size:return(()=>{const[e]=[...s];return V(e,a).length})();default:const t=[...s.map((e=>V(e,a))),a];return z[n](...t)}};function W({ruleset:e,handleBack:t,store:a}){const n=e.rules.map((e=>e.input.name)),s=Array.from(new Set(n)).map((e=>a.getSchema(e))).map((e=>({model:P(e),schema:e}))),[r,l]=k(s),[o,u]=k([]),c=()=>{const t=e.rules,a=[];for(const e of t){const t=e.input,n=r.find((e=>e.model.label===t.name)).model;console.log(n),a.push(V(e.expr,n))}u(a)};return w(I,null,w("div",{className:"mt-16"},w("div",{className:"flex w-11/12"},w("button",{className:"btn-danger px-4 text-md flex",onClick:t},w("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},w("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:4,d:"M11 17l-5-5m0 0l5-5m-5 5h12"})),"Back"),w("div",{className:"flex-1"}),w("button",{onClick:c,className:"submit btn-good"},"Evaluate"))),w("div",{className:"mt-4"},w("h1",{className:"mb-4"},"CONSUMER VIEW"),r.map(((e,t)=>w(j,{model:e.model,onChange:e=>((e,t)=>{const a=[...r];a[t]={model:e,schema:a[t].schema},l(a)})(e,t),schema:e.schema,store:a})))),w("div",{className:"mt-12 flex justify-center"},w("button",{onClick:c,className:"submit btn-good"},"Evaluate")),w("div",{className:"mt-12 flex justify-center"},o.length>0?o.find((e=>e))?w("span",{className:"text-green-600 font-semibold"},"PERMITTED"):w("span",{className:"text-red-600 font-semibold"},"NOT PERMITTED"):w("span",null)))}var $,G;function Y(){const[e,t]=k($.Select),a=O(Ae),[n,s]=k(a.getRuleSets[0]),r=()=>{t($.Select)};return w("div",{className:"px-24"},((e,t)=>{switch(e){case $.Edit:return w(W,{handleBack:r,store:a,ruleset:n});case $.Select:return w(I,null,w("h1",{class:"text-2xl font-semibold mt-16"},"Select a situation to get started"),w("div",{class:"w-11/12 mt-16 rounded border-2 bg-blue-50 border-blue-200 p-4 ml-1 flex flex-wrap"},a.getRuleSets.map((e=>w("div",{className:"w-64 flex card border-2 ml-8 mt-4 py-12 text-center text-xl cursor-pointer hover:bg-gray-200",onClick:()=>t(e)},e.title)))))}})(e,(e=>{s(e),t($.Edit)})))}(G=$||($={})).Edit="edit",G.Select="select";const X=()=>({args:[],op:e.And}),K=()=>({expr:X(),input:{name:"",attributes:[]}}),Q=(e,t,a)=>{const n=e.slice(0);return n[t]=a,n},Z=({schema:e,updateHandler:t})=>{const[a,n]=k(e),{attributes:s}=a,r=e=>t=>{n((a=>{const{attributes:n}=a;return E(T({},a),{attributes:Q(n,e,t)})}))};return w("div",{className:"card my-12 px-12 py-8"},w("form",{onSubmit:e=>((e,a)=>{e.preventDefault(),t(a)})(e,a)},w("div",null,w("h1",{className:"text-2xl font-semibold"},"Schema builder"),w("div",{className:"mt-4"},w("input",{required:!0,type:"text",label:"Name",placeholder:"Name of schema",value:a.name,onInput:e=>{if(e instanceof InputEvent&&e.currentTarget instanceof HTMLInputElement){const t=e.currentTarget.value;n((e=>E(T({},e),{name:t})))}},className:"border-2 text-xl py-2 px-2"})),w("h2",{className:"text-lg mt-6 font-semibold"},"Attributes:"),s.map(((e,t)=>w(_,{attribute:e,onChange:r(t),onDelete:()=>(e=>{n((t=>{const{attributes:a}=t;return E(T({},t),{attributes:a.splice(e,1)})}))})(t)}))),w("div",{className:"mt-2"},w("button",{onClick:()=>{const e=s.concat({label:"",type:f.Boolean});n((t=>E(T({},t),{attributes:e})))},className:"btn-primary mt-4"},"Add new attribute"))),w("div",{className:"mt-8 border-t-2 flex"},w("button",{type:"submit",className:"mt-6 btn-good flex content-center"},w("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},w("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})),"SAVE"),w("button",{onClick:()=>t(e),className:"btn-danger mt-6 ml-4"},"EXIT WITHOUT SAVING"))))},_=({attribute:e,onChange:t,onDelete:a})=>{const{label:n,type:s,enumSet:r,subtype:l}=e;return w("div",{className:"card border-t-2 mt-2 px-4 py-4 flex"},w("div",{className:"flex-1"},w("div",{className:"flex"},w("div",{className:"w-48"},"Label:"),w("input",{className:"border-2",value:n,required:!0,onInput:a=>{if(a instanceof InputEvent&&a.currentTarget instanceof HTMLInputElement){const n=a.currentTarget.value;t(E(T({},e),{label:n}))}}})),w(ee,{availableTypes:M,type:s,onChange:a=>{t(E(T({},e),{type:a}))}}),s===f.Collection&&w(te,{onChange:a=>{t(E(T({},e),{subtype:a}))},selected:e.subtype}),s===f.Enum&&w(ae,{onChange:a=>{t(E(T({},e),{enumSet:a}))},values:e.enumSet})),w("div",{className:"w-10"},w("button",{onClick:a,className:"btn-neutral p-2",title:"Delete this attribute"},w("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},w("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:5,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})))))},ee=({availableTypes:e,type:t,onChange:a})=>w("div",{className:"flex mt-2"},w("div",{className:"w-48"},"Type:"),w("select",{onChange:e=>{e.currentTarget instanceof HTMLSelectElement&&a(+e.currentTarget.value)},className:"border-2",value:t},e.map((e=>w("option",{value:e,selected:e===t},ne(e)))))),te=({selected:e,onChange:t})=>{const a=O(Ae).getSchemata;return w("div",{className:"flex mt-2"},w("div",{className:"w-48"},"Being a group of:"),w("select",{onChange:e=>{e.currentTarget instanceof HTMLSelectElement&&t(e.currentTarget.value)},value:e,className:"border-2"},a.map((e=>e.name)).map((e=>w("option",{value:e},e)))))},ae=({values:e,onChange:t})=>w("div",null,w("div",{className:"flex mt-2"},w("div",{className:"w-48"},"With values:"),w("div",{className:e?"mr-4":""},null==e?void 0:e.map(((a,n)=>w("div",{className:"flex-1 w-96"},w("input",{className:"border-2 w-96",required:!0,value:a,onInput:a=>((a,n)=>{if(n.currentTarget instanceof HTMLInputElement){const s=void 0!==e?[...e]:[""];s[a]=n.currentTarget.value,t(s)}})(n,a)},a))))),w("button",{onClick:()=>{if(e){const a=[...e,""];t(a)}else{t([""])}},className:"btn-primary px-4 h-12"},w("span",{className:""},"Add new option")))),ne=e=>{switch(e){case f.Boolean:return"Yes / No";case f.Date:return"Date";case f.Enum:return"Option list";case f.Number:return"Number";case f.Collection:return"Group of other Schema(s)";case f.Optional:return"Optional value";default:return e}},se=({store:e})=>{const[t,a]=k(T({index:e.getSchemata.length},{name:"",attributes:[]})),[n,s]=k(!1),[r,l]=k(!0),[o,u]=k(!1);L((()=>{a(T({index:e.getSchemata.length},{name:"",attributes:[]}))}),[e]);const{index:c}=t;return w(I,null,w("div",{className:"border-2 bg-blue-100 border-blue-200 rounded-md mt-4 p-4"},w("div",{className:"flex"},w("h1",{className:"font-semibold text-xl"},"All schemata (click each one to edit):"),w("div",{className:"flex-1"}),w("button",{onClick:()=>u(!o),className:"btn-dev"},"<dev> Toggle JSON"),w("button",{onClick:()=>l(!r),className:"btn-primary ml-2"},r?"Collapse":"Expand")),w("div",{className:"mt-4"},0===e.getSchemata.length?w("div",{className:"mt-2"},'No schemata yet! Press "Add new Schema" below to create your first schema.'):r&&e.getSchemata.map(((t,n)=>w("div",{onClick:()=>(t=>{s(!0),a(T({index:t},e.getSchemata[t]))})(n),className:"card mt-2 px-4 py-2 flex cursor-pointer hover:bg-gray-100"},w("span",{className:"w-36 text-2xl"},t.name),w("span",{className:"flex-1 flex content-center"},o&&JSON.stringify(t))))))),!n&&w("button",{onClick:()=>s(!0),className:"btn-primary mt-6"},"Add new Schema"),n&&w(Z,{schema:t,updateHandler:(i=c,t=>{e.editSchema(i,t),s(!1)}),key:c}));var i},re=A(K()),le=({rule:e,index:t,ruleUpdateHandler:a})=>{const n=O(Ae),s=n.getSchemata;return w("div",{className:"card border-2 w-11/12 px-4 py-4 mt-4"},w("h1",{className:"font-semibold text-xl"},"Rule ",t+1),w("div",{className:"flex"},w("h2",{className:"text-lg font-semibold"},"involving the schema:"),w("select",{onChange:e=>{if(e.currentTarget instanceof HTMLSelectElement){const t=e.currentTarget.value,s=n.getSchema(t);a({input:s,expr:X()})}},value:e.input.name,className:"font-semibold ml-2"},s.map((e=>w("option",{value:e.name},e.name))))),w(re.Provider,{value:e},w(oe,{rule:e,exprUpdateHandler:t=>{a(E(T({},e),{expr:t}))}})))},oe=({rule:t,exprUpdateHandler:a})=>{const n=O(Ae),{input:s}=t,r=t.expr,{op:l}=r,o=[e.And,e.Or];return w("div",{className:"p-2 mt-2"},r.args.length>1&&w("select",{onChange:e=>{if(e.currentTarget instanceof HTMLSelectElement){const t=e.currentTarget.value;a(E(T({},r),{op:t}))}},value:l,className:"text-3xl font-semibold"},o.map((e=>w("option",{value:e},e)))),w("span",{className:"ml-4 font-semibold text-lg"},l===e.And?"All of the following:":"At least one of the following:"),w("div",null,r.args.map(((e,t)=>me(e,(e=>t=>{if(ye(r)){const n=Q(r.args,e,t);a(E(T({},r),{args:n}))}})(t))))),w("button",{onClick:()=>{if(ye(r)){const e=r.args,t=ce(n,s);a(E(T({},r),{args:e.concat(t)}))}},className:"btn-primary text-md font-semibold mt-4"},"New condition"),w("button",{onClick:()=>{if(ye(r)){const t=r.args,l={args:[ce(n,s)],op:e.And};a(E(T({},r),{args:t.concat(l)}))}},className:"btn-primary text-md font-semibold mt-4 ml-2"},"New logic group"))},ue=({expr:t,exprUpdateHandler:a})=>{const n=O(Ae),s=O(re),{op:r}=t,l=[e.And,e.Or];return w("div",{className:"card border-2 border-gray-300 p-2 mt-2"},t.args.length>1&&w("select",{onChange:e=>{if(e.currentTarget instanceof HTMLSelectElement){const n=e.currentTarget.value;a(E(T({},t),{op:n}))}},value:r,className:"text-xl font-semibold"},l.map((e=>w("option",{value:r},e)))),t.args.map(((e,n)=>w("div",{id:"test-sep",class:"mt-2"},me(e,(e=>n=>{if(ye(t)){const s=Q(t.args,e,n);a(E(T({},t),{args:s}))}})(n))))),w("button",{onClick:()=>{if(ye(t)){const e=t.args,r=ce(n,s.input);a(E(T({},t),{args:e.concat(r)}))}},className:"btn-primary text-sm font-normal mt-4"},"New condition"),w("button",{onClick:()=>{if(ye(t)){const r=t.args,l={args:[ce(n,s.input)],op:e.And};a(E(T({},t),{args:r.concat(l)}))}},className:"btn-primary text-sm font-normal mt-4 ml-2"},"New logic group"))},ce=(e,t)=>{const a=t.attributes[0],{label:n}=a,s={args:[n],op:b.Lookup};return ie(e,a,s)},ie=(e,t,a)=>{switch(t.type){case f.Model:const n=e.getSchema(t.subtype).attributes[0],{label:s}=n,r={args:[s,a],op:b.Lookup};return ie(e,n,r);case f.Collection:return(()=>{const n=e.getSchema(t.subtype);return{args:[a,ce(e,n)],op:i.AnyOf}})();case f.Enum:return{args:[a,t.enumSet[0]],op:l.Is};default:return pe(t.type,a)}},pe=(e,t)=>{switch(e){case f.Date:return{args:[t,Date.now()],op:a.IsAfter};case f.Number:return{args:[t,0],op:s.Equal};case f.Boolean:return{args:[t],op:u.IsChecked};case f.Optional:return{args:[t],op:m.Exists};default:return X()}},me=(t,n)=>{switch(t.op){case b.Lookup:return w(be,{exp:t,exprUpdateHandler:n});case s.Equal:case s.LessThan:case s.LessThanOrEqual:case s.MoreThan:case s.MoreThanOrEqual:return w(ve,{exp:t,exprUpdateHandler:n});case i.AllOf:case i.AnyOf:case i.NoneOf:case i.NumberOf:case i.Size:return w(fe,{exp:t,exprUpdateHandler:n});case a.IsAfter:case a.IsBefore:case a.IsBetween:return w(he,{exp:t,exprUpdateHandler:n});case l.Is:case l.IsNot:return w(xe,{exp:t,exprUpdateHandler:n});case u.IsChecked:case u.IsNotChecked:return w(Ne,{exp:t,exprUpdateHandler:n});case m.Exists:case m.ExistsAnd:return w(de,{exp:t,exprUpdateHandler:n});case e.And:case e.Or:return w(ue,{expr:t,exprUpdateHandler:n});default:return w("div",{class:"border-2"},JSON.stringify(t))}},de=({exprUpdateHandler:e,exp:t})=>w("div",null,"Optional operations"),be=({exprUpdateHandler:e,exp:t})=>{const a=O(re),n=a.input.attributes.map((e=>e.label)),s=t.args[0],r=O(Ae);return w("select",{onChange:n=>{if(n.currentTarget instanceof HTMLSelectElement){const s=n.currentTarget.value,l=a.input.attributes.find((e=>e.label===s)),o=E(T({},t),{args:[s]}),u=ie(r,l,o);e(u)}},value:s},n.map((e=>w("option",{value:e},e))))},fe=({exprUpdateHandler:e,exp:t})=>{const a=[i.AllOf,i.AnyOf,i.NoneOf,i.NumberOf,i.Size],{args:n,op:s}=t,[r,l]=n,o=a=>{const s=[n[0],a];e(E(T({},t),{args:s}))},u=O(re).input.attributes,c=O(Ae);return w("div",{className:"mt-4"},me(r,(t=>{e(t)})),w("select",{onChange:a=>{if(a.currentTarget instanceof HTMLSelectElement){const s=a.currentTarget.value;if(s===i.Size){const t=[n[0]],a=pe(f.Number,{args:t,op:s});return e(a)}if(s===i.NumberOf){const a=pe(f.Number,E(T({},t),{op:s}));return e(a)}e(E(T({},t),{op:s}))}},value:s},a.map((e=>w("option",{value:e},e)))),ye(l)&&(e=>{const a=t.args[0].args[0],n=u.find((e=>e.label===a)).subtype,s=c.getSchema(n),r=E(T({},K()),{input:s});return w(re.Provider,{value:r},w(ge,{exprUpdateHandler:o,exp:e}))})(l))},ge=({exprUpdateHandler:e,exp:t})=>{const a=O(re);return w(I,null,a.input.name,me(t,e))},he=({exprUpdateHandler:e,exp:t})=>{const n=[a.IsAfter,a.IsBefore,a.IsBetween],{args:s,op:r}=t,[l,o,u]=s;return w(I,null,me(l,(t=>{e(t)})),w("select",{onChange:a=>{if(a.currentTarget instanceof HTMLSelectElement){const n=a.currentTarget.value;e(E(T({},t),{op:n}))}},value:r},n.map((e=>w("option",{value:e},Se(e))))),w("input",{type:"date",name:"Date",onInput:a=>{if(a.currentTarget instanceof HTMLInputElement){const n=JSON.parse(a.currentTarget.value),r=[s[0],n];e(E(T({},t),{args:r}))}},value:o}),r===a.IsBetween&&w(I,null,"And",w("input",{type:"date",name:"Date",onInput:n=>{if(r===a.IsBetween&&n.currentTarget instanceof HTMLInputElement){const a=JSON.parse(n.currentTarget.value),r=[s[0],s[1],a];e(E(T({},t),{args:r}))}},value:u})))},ve=({exprUpdateHandler:e,exp:t})=>{const a=[s.Equal,s.LessThan,s.LessThanOrEqual,s.MoreThan,s.MoreThanOrEqual],{args:n,op:r}=t,[l,o]=n;return w(I,null,me(l,(t=>{e(t)})),w("select",{onChange:a=>{if(a.currentTarget instanceof HTMLSelectElement){const n=a.currentTarget.value;e(E(T({},t),{op:n}))}},value:r},a.map((e=>w("option",{value:e},Se(e))))),w("input",{type:"number",name:"Number",onInput:a=>{if(a.currentTarget instanceof HTMLInputElement){const s=JSON.parse(a.currentTarget.value),r=[n[0],s];e(E(T({},t),{args:r}))}},value:o}))},xe=({exprUpdateHandler:e,exp:t})=>{const a=[l.Is,l.IsNot],n=O(re).input.attributes,s=t.args[0].args[0],r=n.find((e=>e.label===s)).enumSet,{args:o,op:u}=t,[c,i]=o;return w("div",null,me(c,(t=>{e(t)})),w("select",{onChange:a=>{if(a.currentTarget instanceof HTMLSelectElement){const n=a.currentTarget.value;e(E(T({},t),{op:n}))}},value:u},a.map((e=>w("option",{value:e},Se(e))))),w("select",{onChange:a=>{if(a.currentTarget instanceof HTMLInputElement){const n=JSON.parse(a.currentTarget.value),s=[o[0],n];e(E(T({},t),{args:s}))}},value:i},r.map((e=>w("option",{value:e},e)))))},Ne=({exprUpdateHandler:e,exp:t})=>{const a=[u.IsChecked,u.IsNotChecked],{args:n,op:s}=t,[r]=n;return w("div",{className:"mt-2"},me(r,(t=>{e(t)})),w("select",{onChange:a=>{if(a.currentTarget instanceof HTMLSelectElement){const n=a.currentTarget.value;e(E(T({},t),{op:n}))}},value:s},a.map((e=>w("option",{value:e},Se(e))))))},ye=e=>"object"==typeof e&&"op"in e,Se=e=>{switch(e){case b.Lookup:case s.Equal:return"Equals";case s.LessThan:return"Is less than";case s.LessThanOrEqual:return"Is less than or equal to";case s.MoreThan:return"Is more than";case s.MoreThanOrEqual:return"Is more than or equal to";case i.AllOf:case i.AnyOf:case i.NoneOf:case i.NumberOf:case i.Size:return"Size";case a.IsAfter:return"Is after";case a.IsBefore:return"Is before";case a.IsBetween:return"Is between";case l.Is:return"Is";case l.IsNot:return"Is not";case u.IsChecked:return"Is true";case u.IsNotChecked:return"Is not true";case m.Exists:return"Exists";case m.ExistsAnd:return"Exists and";default:return e}},Ce=({ruleSet:e,updateHandler:t})=>{const a=O(Ae).getSchemata,[n,s]=k(e),[r,l]=k(""),{title:o,rules:u}=n,c=e=>t=>{s((a=>{const{rules:n}=a;return E(T({},a),{rules:Q(n,e,t)})}))};return w("div",{className:"card mt-12 px-4 py-4"},w("div",null,w("h1",{className:"font-semibold text-2xl"},"New Ruleset"),w("div",{className:"mt-4"},w("input",{type:"text",value:o,placeholder:"Title of ruleset",onInput:e=>{if(e instanceof InputEvent&&e.currentTarget instanceof HTMLInputElement){const t=e.currentTarget.value;s((e=>E(T({},e),{title:t})))}},className:"text-xl font-semibold py-2 px-2 w-1/2"})),w("h2",{className:"text-lg font-semibold mt-6"},"Rules (disjunctive):"),u.map(((e,t)=>w(le,{rule:e,index:t,ruleUpdateHandler:c(t)}))),w("button",{onClick:()=>{if(0===a.length)return l("Add new Schema first"),void setTimeout((()=>{l("")}),1e3);const e=E(T({},K()),{input:a[0]}),t=u.concat(e);s((e=>E(T({},e),{rules:t})))},className:"btn-primary mt-8"},"Add new rule")),r&&w("div",null,r),w("button",{onClick:()=>t(n),className:"btn-good mt-10"},"Done"))},Te=({store:e})=>{const[t,a]=k(T({index:e.getRuleSets.length},{rules:[],title:""})),[n,s]=k(!1);L((()=>{a(T({index:e.getRuleSets.length},{rules:[],title:""}))}),[e]);const{index:r}=t,[l,o]=k(!1),[u,c]=k(!0);return w(I,null,w("div",null,"Ruleset Editor"),w("div",{className:"border-2 bg-blue-100 border-blue-200 rounded-md mt-4 p-4"},w("div",{className:"flex"},w("div",{className:"font-semibold text-xl"},"All rulesets:"),w("div",{className:"flex-1"}),w("button",{onClick:()=>o(!l),className:"btn-dev"},"<dev> Toggle JSON"),w("button",{onClick:()=>c(!u),className:"btn-primary ml-2"},u?"Collapse":"Expand")),u&&e.getRuleSets.map(((t,n)=>w("div",{className:"card mt-2 px-4 py-2 flex cursor-pointer hover:bg-gray-100",onClick:()=>(t=>{s(!0),a(T({index:t},e.getRuleSets[t]))})(n)},w("span",{className:"text-2xl w-64"},t.title),w("span",{className:"flex-1"},l&&JSON.stringify(t,null,2)))))),w("div",{className:"text-center mt-10 font-semibold"},"Tip: An activity is considered permitted if any rule evaluates to TRUE."),n?w(Ce,{ruleSet:t,updateHandler:(i=r,t=>{e.editRuleSet(i,t),s(!1)}),key:r}):w("button",{onClick:()=>s(!0),className:"btn-primary mt-12"},"Add new Ruleset"));var i};var Ee;!function(e){e.Schema="schema",e.RuleSet="ruleset"}(Ee||(Ee={}));const we=()=>{const[e,t]=k(Ee.Schema),a=O(Ae);return w("div",{className:"mt-16 border-gray-200 px-24"},w("h1",null,"CURATOR VIEW"),w("div",{class:"mx-auto mt-4 flex w-48 rounded-md border-2 border-gray-300 bg-gray-100"},w("div",{class:`curatorbutton flex-1 w-16 h-10 border-r-2 border-gray-200 cursor-pointer flex items-center justify-center rounded-l-sm \n            ${e===Ee.Schema&&"bg-white"}`,onClick:()=>t(Ee.Schema)},"Schema"),w("div",{class:`consumerbutton flex-1 w-16 h-10 cursor-pointer flex items-center justify-center rounded-r-sm \n            ${e===Ee.RuleSet&&"bg-white"}`,onClick:()=>t(Ee.RuleSet)},"Ruleset")),(e=>{switch(e){case Ee.Schema:return w(se,{store:a});case Ee.RuleSet:return w(Te,{store:a})}})(e))};class Ie{constructor(e,t){this.addSchema=e=>{const t=this.ruleStore.schemata.concat(e);this.setFn(E(T({},this.ruleStore),{schemata:t}))},this.editSchema=(e,t)=>{let a=this.ruleStore.schemata.slice();a[e]=t,this.setFn(E(T({},this.ruleStore),{schemata:a}))},this.editRuleSet=(e,t)=>{let a=this.ruleStore.ruleSets.slice();a[e]=t,this.setFn(E(T({},this.ruleStore),{ruleSets:a}))},this.getSchema=e=>{const t=this.ruleStore.schemata.find((t=>t.name===e));if(void 0===t)throw new Error("schema not in rulestore");return t},this.setFn=t,this.ruleStore=e}get getSchemata(){return this.ruleStore.schemata}get getRuleSets(){return this.ruleStore.ruleSets}}const ke={rules:[{input:{index:1,name:"Dine-In",attributes:[{label:"F&B Establishment ",type:3},{label:"Number Of Person",type:1},{label:"Adults",type:4,subtype:"Person"},{label:"Children",type:4,subtype:"Person"},{label:"Type of F&B Establishment",type:2,enumSet:["Hawker Centre","Coffee Shop","Restaurant"]},{label:"Children Same Household",type:3}]},expr:{args:[{args:[{args:["Adults"],op:"Lookup"},{args:[{args:["Is fully vaccinated"],op:"Lookup"}],op:"IsChecked"}],op:"AllOf"},{args:[{args:[{args:["Children"],op:"Lookup"}],op:"Size"},0],op:"Equal"},{args:[{args:["Type of F&B Establishment"],op:"Lookup"},"Restaurant"],op:"Is"},{args:[{args:["Number Of Person"],op:"Lookup"},5],op:"LessThanOrEqual"}],op:"And"}},{input:{name:"Dine-In",attributes:[{label:"F&B Establishment ",type:3},{label:"Number Of Person",type:1},{label:"Adults",type:4,subtype:"Person"},{label:"Children",type:4,subtype:"Person"},{label:"Type of F&B Establishment",type:2,enumSet:["Hawker Centre","Coffee Shop","Restaurant"]},{label:"Children Same Household",type:3}]},expr:{args:[{args:[{args:["Adults"],op:"Lookup"},{args:[{args:["Is fully vaccinated"],op:"Lookup"}],op:"IsChecked"}],op:"AllOf"},{args:[{args:[{args:["Children"],op:"Lookup"}],op:"Size"},5],op:"LessThanOrEqual"},{args:[{args:[{args:["Adults"],op:"Lookup"}],op:"Size"},5],op:"LessThanOrEqual"},{args:[{args:["Number Of Person"],op:"Lookup"},5],op:"LessThanOrEqual"},{args:[{args:["Children Same Household"],op:"Lookup"}],op:"IsChecked"},{args:[{args:["Type of F&B Establishment"],op:"Lookup"},"Restaurant"],op:"Is"}],op:"And"}},{input:{name:"Dine-In",attributes:[{label:"F&B Establishment ",type:3},{label:"Number Of Person",type:1},{label:"Adults",type:4,subtype:"Person"},{label:"Children",type:4,subtype:"Person"},{label:"Type of F&B Establishment",type:2,enumSet:["Hawker Centre","Coffee Shop","Restaurant"]},{label:"Children Same Household",type:3}]},expr:{args:[{args:[{args:["Number Of Person"],op:"Lookup"},2],op:"LessThanOrEqual"},{args:[{args:[{args:["Type of F&B Establishment"],op:"Lookup"},"Hawker Centre"],op:"Is"},{args:[{args:["Type of F&B Establishment"],op:"Lookup"},"Coffee Shop"],op:"Is"}],op:"Or"}],op:"And"}}],title:"Dine In"},Oe=()=>({schemata:[{name:"Gathering",attributes:[{label:"Group",type:f.Collection,subtype:"Person"},{label:"All from same household",type:f.Boolean}]},{name:"Dine-In",attributes:[{label:"F&B Establishment ",type:3},{label:"Number Of Person",type:1},{label:"Adults",type:4,subtype:"Person"},{label:"Children",type:4,subtype:"Person"},{label:"Type of F&B Establishment",type:2,enumSet:["Hawker Centre","Coffee Shop","Restaurant"]},{label:"Children Same Household",type:3}]},{name:"Person",attributes:[{label:"Age",type:f.Number},{label:"Is fully vaccinated",type:f.Boolean},{label:"Type of vaccine",type:f.Enum,enumSet:["Pfizer","Moderna","Sinovac","Other"]},{label:"Date of vaccination",type:f.Date}]},{name:"MICE event pilots",attributes:[{label:"Participants are all fully vaccinated",type:f.Boolean},{label:"Type of event",type:f.Enum,enumSet:["Participants are predominantly seated or standing in a fixed position during the session.","Participants are predominantly non-seated and moving about during the session."]},{label:"Number of participants",type:f.Number}]}],ruleSets:[D,ke]});var Le;!function(e){e.Curator="curator",e.Consumer="consumer"}(Le||(Le={}));const Ae=A(new Ie(Oe(),(()=>{})));function He(){const[e,t]=k(Le.Consumer),[a,n]=k(Oe()),s=new Ie(a,n);return w(I,null,w("div",{class:"App py-10"},w("div",{class:"mx-auto mt-4 flex w-48 rounded-md border-2 border-gray-300"},w("div",{class:"curatorbutton flex-1 w-16 h-10 border-r-2 border-gray-200 cursor-pointer flex items-center justify-center rounded-l-sm\n            "+(e===Le.Curator?"bg-white":""),onClick:()=>t(Le.Curator)},"Curator"),w("div",{class:"consumerbutton flex-1 w-16 h-10 cursor-pointer flex items-center justify-center rounded-r-sm\n            "+(e===Le.Consumer?"bg-white":""),onClick:()=>t(Le.Consumer)},"Consumer"))),w(Ae.Provider,{value:s},(e=>{switch(e){case Le.Curator:return w(we,null);case Le.Consumer:return w(Y,null)}})(e)))}H(w(He,null),document.getElementById("app"));
